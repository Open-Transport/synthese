<ul class="breadcrumb">
 <li class="active">Administration</li>
</ul>

<ul id="nav_tabs" class="nav nav-tabs">
 <#tab_title&default=1&id=message_types&title=Types de messages#>
 <#tab_title&id=display_types&title=Types de bornes#>
 <#tab_title&id=mailing_lists&title=Listes de diffusion#>
 <#tab_title&id=broadcast_points&title=Autres diffuseurs#>
 <#tab_title&id=log&title=Journal#>
</ul>

<div id="tab_content" class="tab-content">

<#tab_div&default=1&id=message_types#>

 <table class="table table-striped table-condensed">
  <thead>
   <tr><th>nom</th><th>taille max</th><th></th></tr>
  </thead><tbody>

   <?message_types&template=<{type&template=
     <?form&
       name=update<@id@>&
       page_id=<@p@>&
       a=ObjectUpdate&actionParam_object_id=<@id@>&
       tab=message_types&
     ?>
      <tr>
       <td><input name="actionParam_field_name" value="<@name@>" /></td>
       <td><input name="actionParam_field_max_length" value="<@max_length@>" /></td>
       <td>
        <button class="btn btn-primary">Modifier</button> 
        <?link&
          target=<@p@>&
          class=btn btn-danger&
          confirm=Etes-vous sûr de vouloir supprimer le type <@name@>?&
          text=Supprimer&
          a=RemoveObjectAction&actionParamoi=<@id@>&
        ?>
       </td>
      </tr>
     </form>
   }>?>

  </tbody><tfoot>

   <?form&
     name=add&
     page_id=<@p@>&
     a=ObjectCreate&
     actionParam_table_id=101&
     tab=message_types&
   ?>
    <tr>
     <td><input name="actionParam_field_name" value="" /></td>
     <td><input name="actionParam_field_max_length" value="" /></td>
     <td><button class="btn btn-primary">Ajouter</button></td>
    </tr>
   </form>
  </tfoot>
 </table>
</div>

<#tab_div&id=display_types#>

 <table class="table table-condensed table-striped">
  <thead><tr><th>type de borne</th><th>type de message</th><th>règle d'affichage</th></tr></thead>
  <tbody>
   <?display_types&template=<{display_type&template=
	<tr>
	 <td><@name@></td>
	 <td><?form&tab=display_types&class=form-inline&page_id=<@p@>&name=message_type_<@id@>&a=updatedisplaytype&actionParamdtu_id=<@id@>?><select name="actionParam_message_type_id"><option value="0">Message principal</option><?message_types&template=<{type&template=<option value="<@id@>" <?if&cond=<@message_type_id==id@>&then=selected="true"?>><@name@></option>}>?></select><button class="btn btn-primary">Modifier</button></form></td>
	 <td><?form&tab=display_types&class=form-inline&page_id=<@p@>&name=message_rule_<@id@>&a=updatedisplaytype&actionParamdtu_id=<@id@>?><select name="actionParam_message_is_displayed_page_id"><option value="0">Pas de règle</option><?menu&root=17733086741528586&raw_data=1&template=<{page&template=<option value="<@id@>" <?if&cond=<@message_is_displayed_page_id==id@>&then=selected="true"?>><@title@></option>}>?>?></select><button class="btn btn-primary">Modifier</button></form></td>
	</tr>
   }>?>
  </tbody>
 </table>
</div>


<#tab_div&id=mailing_lists#>
 <?form&
   name=add_mailing_list&
   a=ObjectCreate&
   actionParam_table_id=107&
   target=/admin/mailing_list&
   co=1&
 ?>
  <table class="table table-striped table-condensed">
  <thead><tr>
   <th>liste</th><th>type de message</th><th>expéditeur</th><th></th>
  </tr></thead><tbody>
  <?mailing_lists&
    template=<{mailing_list&template=
 	<tr>
 	 <td><@name@></td>
 	 <td><?message_types&roid=<@message_type_id@>&template=<{type&template=<@name@>}>?></td>
 	 <td><@sender_name@><br /><@sender@></td>
 	 <td>
 	  <?link&
 	    target=/admin/mailing_list&
 	    roid=<@id@>&
 	    text=Ouvrir&
 	    class=btn btn-primary&
 	  ?>
 	 <?link&
  	   target=<@p@>&
  	   a=RemoveObjectAction&
  	   tab=mailing_lists&
  	   actionParamoi=<@id@>&
  	   confirm=Etes-vous sûr de vouloir supprimer la liste de diffusion <@name@> ?&
  	   text=Supprimer&
  	   class=btn btn-danger&
	 ?>

 	 </td>
 	</tr>
  }>?>
  </tbody><tfoot>
   <tr>
    <td><input type="text" name="actionParam_field_name" placeholder="Nom" /></td>
    <td>
     <select name="actionParam_message_type_id">
      <option value="0">Message principal</option>
      <?message_types&
        template=<{type&template=
      		<option value="<@id@>"><@name@></option>}>
      ?>
     </select>
    </td>
    <td>
     <input type="text" name="actionParam_field_sender_name" placeholder="Libellé expéditeur" /><br />
     <input type="text" name="actionParam_field_sender" placeholder="E-mail expéditeur" />
    </td>
    <td><button type="submit" class="btn btn-warning">Ajouter</button></td>
   </tr>
  </tfoot></table>
 </form>
</div>

<#tab_div&id=broadcast_points#>
 <@bp_id=<@((tab=="broadcast_points")&&roid)?roid:0@>@>
 
 <div class="row-fluid">
  <div class="span3" id="tree">
   <ul class="nav nav-list well">
    <li<@bp_id?"":" class=\"active\""@>>
     <?link&
       target=<@p@>&
       tab=broadcast_points&
       text=Autres diffuseurs<@bp_id?"":"<div class=\"pull-right\" onclick=\"$('#bp_new').modal('show'); return false;\"><i class=\"icon-plus icon-white\"></i></div>"@>
     ?>
    </li>
    <?custom_broadcast_points&
      parent_id=0&
      recursive=1&
      template=<{broadcast_point&recursive=1&template=
 	<li<@(id==bp_id)?" class=\"active\"":""@> style="padding-left:<@15+(depth*15)@>px;">
 	 <?link&
  	   target=<@p@>&
   	   tab=broadcast_points&
   	   roid=<@id@>&
  	   text=<@name@>
   	      <@(id==bp_id)?"<div class=\"pull-right\" onclick=\"$('#bp_new').modal('show'); return false;\"><i class=\"icon-plus icon-white\"></i></div>":""@>
   	      <@((!recursive_content)&&(id==bp_id))?"<div class=\"pull-right\" onclick=\"$('#bp_remove').modal('show'); return false;\"><i class=\"icon-remove icon-white\"></i></div>":""@>
      	 ?>
	</li>
   	<@recursive_content@>   
    }>?>
   </ul>
  </div><div class="span9">
   <?if&
     cond=<@bp_id@>&
     then=
      <?custom_broadcast_points&
	roid=<@bp_id@>&
	template=<{broadcast_point&template=
		<?form&
		  name=update&
		  a=ObjectUpdate&
		  actionParam_object_id=<@bp_id@>&
		  target=<@p@>&
		  class=form-horizontal&
		  roid=<@roid@>&
		?>
		 <div class="control-group">
		  <label class="control-label">Nom</label>
		  <div class="controls">
		   <input type="text" name="actionParam_field_name" value="<@name@>" />
		  </div>
		 </div>
	
		 <div class="control-group">
		  <label class="control-label">Type de message</label>
		  <div class="controls">
		   <select name="actionParam_field_message_type_id">
		    <option value="0">Message principal</option>
		    <?message_types&template=<{type&template=<option value="<@id@>" <?if&cond=<@message_type_id==id@>&then=selected="true"?>><@name@></option>}>?>
		   </select>
		  </div>
		 </div>
	
		 <div class="control-group">
		  <label class="control-label">Règle de diffusion</label>
		  <div class="controls">
		   <textarea name="actionParam_field_broadcast_rule"><@broadcast_rule@></textarea>
		  </div>
		 </div>
	
		 <div class="control-group">
		  <div class="controls">
		   <button type="submit" class="btn btn-warning">Enregistrer</button>
		  </div>
		 </div>
     }>?>&
     else=
      <div class="alert alert-info">Sélectionnez un diffuseur dans le menu ci-contre</div>
   ?>
  </div>
 </div>
</div><#tab_div&id=log#>

    <div class="pagination">
    <ul>
    <?if&cond=<@r>=150@>&then=<li><?link&target=<@p@>&r=0&text=1&tab=log?></li>?>
    <?if&cond=<@r>=200@>&then=<li class="disabled"><a href="#">...</a></li>?>
    <?if&cond=<@r>=100@>&then=<li><?link&target=<@p@>&r=<@r-100@>&text=<@(r/50)-1@>&tab=log?></li>?>
    <?if&cond=<@r>=50@>&then=<li><?link&target=<@p@>&r=<@r-50@>&text=<@(r/50)@>&tab=log?></li>?>
    <li class="active"><a href="#"><@1+(r/50)@></a></li>
    <li><?link&target=<@p@>&r=<@r+50@>&text=<@(r/50)+2@>&tab=log?></li>
    <li><?link&target=<@p@>&r=<@r+100@>&text=<@(r/50)+3@>&tab=log?></li>
    </ul>
    </div>

<table class="table-striped table-condensed table">
<thead><tr>
<th>date</th>
<th>utilisateur</th>
<th>événement</th>
<th>contenu</th>
<th>action</th>
</tr></thead>
<tbody>
<?db_log&
	log_key=messages&
	first=<@r@>&
	template=<{entry&template=
		<tr>
		<td><@date@></td>
		<td><{user&template=<@login@>}></td>
		<td><@object_name@></td>
		<td><@col0@></td>
		<td><?substr&t=<@col1@>&n=200?></td>
		</tr>
	}>
?>
</tbody>
</table>

</div>

</div>


<div class="modal hide fade" id="bp_new">
 <div class="modal-header">
  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
  <h3>Nouveau diffuseur</h3>
 </div>
 <?form&
   name=bp_newdir&
   a=ObjectCreate&
   actionParam_table_id=106&
   target=<@p@>&
   tab=broadcast_points&
   co=1&
   class=form-horizontal&
   actionParam_field_up_id=<@bp_id@>
 ?>
  <div class="modal-body">
   <div class="control-group">
    <label class="control-label">Nom</label>
    <div class="controls">
     <input type="text" name="actionParam_field_name" />
    </div>
   </div>
  </div><div class="modal-footer">
   <button class="btn btn-warning" type="submit">Créer le diffuseur</button>
   <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Annuler</button>
  </div>
 </form>
</div>

<div class="modal hide fade" id="bp_remove">
 <div class="modal-header">
  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
  <h3>Suppression de diffuseur</h3>
 </div>
 <?form&
   name=pb_removedir&
   a=RemoveObjectAction&
   target=<@p@>&
   tab=broadcast_points&
   actionParamoi=<@bp_id@>
 ?>
  <div class="modal-body">
   <p>Etes-vous sûr de vouloir supprimer le diffuseur ?</p>
  </div><div class="modal-footer">
   <button class="btn btn-danger" type="submit">Oui</button>
   <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Non</button>
  </div>
 </form>
</div>