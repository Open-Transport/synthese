<project name="synthese" default="all" basedir=".">

  <import file="../common.xml"/>

  <property name="version" value="3_0"/>
  <property name="lang" value="c++"/>
  
  <property name="include.home" value="${src.home}"/>
  <property name="deploy.local.lib.regexp.from" value="(.*)"/>
  <property name="deploy.local.lib.regexp.to" value="\1"/>



  <target name="deploy"/>



  <target name="build">

    <antcall target="sconsbuild">
      <param name="goal" value="dist"/>
      <param name="target" value="${target}"/>
    </antcall>

   <basename property="distname" file="${target}"/>

   <property name="distdir"
   value="${dist.home}/${distname}_${platform}_${mode}"/>

   <if>
     <and>
       <equals arg1="${platform}" arg2="posix"/>
       <equals arg1="${mode}" arg2="release"/>
     </and>
     <then>
       <echo message="Stripping ${distdir}/${distname}"/>
       <exec executable="strip" failonerror="true" 
	    resolveexecutable="true" searchpath="true">
	<arg value="${distdir}/${distname}"/>
      </exec>       
     </then>
   </if>
   
   <delete file="${distdir}.zip"/> 
   <zip destfile="${distdir}.zip"> 

     <zipfileset filemode="755" dir="${dist.home}" 
		 includes="${distname}_${platform}_${mode}/${distname},
		           ${distname}_${platform}_${mode}/**/*.sh"/>

     <zipfileset dir="${dist.home}"
		 includes="${distname}_${platform}_${mode}/**"
		 excludes="${distname}_${platform}_${mode}/${distname},
		           ${distname}_${platform}_${mode}/**/*.sh"/>

   </zip>

  </target>








</project>

