<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Route Planner</title>
  <style>
  html {
    font: Canberra, sans-serif;
  }
  form > p {
    margin: 2em
  }
  input[type=text] {
    width: 20em;
    border: 1px solid gray;
  }
  </style>
  
  <script src="../core/vendor/jquery-1.6.2.min.js"></script>

  <script src="../core/js/Synthese.js"></script>
  <script src="../routePlanner/js/legacy/core.js"></script>
  <script src="../routePlanner/js/legacy/interface.js"></script>
  <!-- <script src="../routePlanner/js/legacy/FicheHoraire.js"></script>  -->

  <script>
// TODO: move some of this to the routePlanner library.
function initAutoCompletions(siteId) {
  if (document.getElementsByTagName) {
    var inputElements = document.getElementsByTagName("input");
    for (i = 0; inputElements[i]; i++)
      inputElements[i].setAttribute("autocomplete", "off");
  }
  // TODO: refactor more
  initAutoCompleteForm(document.forms["routePlannerForm"], document.getElementById("submitButton"));
  initAutoCompleteField(0, document.getElementById("origin_city_txt"), null, function (city, place) {
    return Synthese.URL + '?fonction=lc&n=10&at_least_a_stop=1&o=1&si=' + siteId + '&t=' + city + '';
  }, document.getElementById("origin_place_txt"), null, null);
  initAutoCompleteField(1, document.getElementById("origin_place_txt"), document.getElementById("origin_city_txt"), function (city, place) {
    return Synthese.URL + '?ct=' + city + '&fonction=lp&n=10&o=1&si=' + siteId + '&t=' + place + '';
  }, null, null, null);
  initAutoCompleteField(2, document.getElementById("destination_city_txt"), null, function (city, place) {
    return Synthese.URL + '?fonction=lc&n=10&at_least_a_stop=1&o=0&si=' + siteId + '&t=' + city + '';
  }, document.getElementById("destination_place_txt"), null, null);
  initAutoCompleteField(3, document.getElementById("destination_place_txt"), document.getElementById("destination_city_txt"), function (city, place) {
    return Synthese.URL + '?ct=' + city + '&fonction=lp&n=10&o=0&si=' + siteId + '&t=' + place + '';
  }, null, null, null);
  document.getElementById("origin_city_txt").focus();
  if (document.getElementById("fh")) {
    addEvent(document.getElementById("fh"), "mouseover", mouse_event_handler);
    addEvent(document.getElementById("fh"), "click", mouse_click_handler);
  }
}
  
$(function() {
  function parseQueryString(str) {
    var paramArray = str.split("&");
    var regex = /^([^=]+)=(.*)$/;
    var params = {};
    for (var i = 0, sz = paramArray.length; i < sz; i++) {
     var match = regex.exec(paramArray[i]);
     if (!match)
       throw "Bad parameter in queryString! '" + paramArray[i] + "'";
       params[decodeURIComponent(match[1])] = decodeURIComponent(match[2]);
     } 
     return params;
  }
  
  var urlOptions = parseQueryString(location.search.slice(1));
  console.log(urlOptions);
  
  console.log("url", Synthese.URL);
  
  if (!urlOptions.siteId) {
    alert("Missing siteId in query string");
    return;
  }
  initAutoCompletions(urlOptions.siteId);
  
  if(0)
  $("input").keypress(function(e) {
    if (e.which == 13) {
      alert("submit");
    }
  });
});

 
  </script>
  
</head>
<body>
  <h1>Route Planner Demo</h1>

  <form action="/todo" name="routePlannerForm">
      

  <p>
    Departure town <a href="#">Map</a><br>
    <input type=text autofocus name=dct id=origin_city_txt><br>
    Departure stop (optional)<br>
    <input type=text name=act id=origin_place_txt><br>
  </p>

  <p>
    Arrival town <a href="#">Map</a><br>
    <input type=text name=act id=destination_city_txt><br>
    Arrival stop (optional)<br> 
    <input type=text name=apt id=destination_place_txt><br>
  </p>

  <p>
    <input type="submit" id="submitButton" value="Submit">
  </p>
  
  </form>

</body>
</html>
