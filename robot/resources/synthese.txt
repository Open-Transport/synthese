*** Settings ***
Documentation     Bla bla bla
Library           RequestsLibrary

*** Variables ***
${S3_SERVER}      /home/mjambert/Workspace/rcs/git/synthese3/build/src/bin/server/s3-server
${S3_SERVER_DB}    config.db3
${S3_SERVER_PORT}    8080
${S3_SERVER_URL}    http://localhost:${S3_SERVER_PORT}/

*** Keywords ***
Start Synthese
    Start Process    ${S3_SERVER}    '--param port\=8084'    stderr=s3.err    stdout=s3.out
    Wait Until Keyword Succeeds    2 min    5 sec    Open Connection    localhost    ${None}    ${S3_SERVER_PORT}

Stop Synthese
    Terminate Process

Create Synthese Object
    [Arguments]    ${tableId}    @{varargs}
    ${httpResponse}=    Call Synthese Service    objectcreate    table_id\=${tableId}    @{varargs}
    [Return]    ${httpResponse}

Call Synthese Service
    [Arguments]    ${serviceName}    @{varargs}
    Create Session    synthese    ${S3_SERVER_URL}
    ${serviceParameters}=    Catenate    SEPARATOR=&    @{varargs}
    ${httpResponse}=    Get Request    synthese    ?SERVICE=${serviceName}&${serviceParameters}
    [Return]    ${httpResponse}

Call Synthese Action
    [Arguments]    ${actionName}    @{varargs}
    Create Session    synthese    ${S3_SERVER_URL}
    ${actionParameters}=    Catenate    SEPARATOR=&    @{varargs}
    ${httpResponse}=    Get Request    synthese    ?SERVICE=version&a=${actionName}&${actionParameters}
    [Return]    ${httpResponse}
